# 个性化神仙对话功能指南

## 功能概述

个性化神仙对话功能是基于用户的八字信息、今日运势和个人特征，与AI神仙进行智能对话的系统。系统会根据用户的出生信息计算八字，结合当前日期计算今日运势，从而提供个性化的智慧指导和建议。

## 核心特性

### 1. 八字分析集成
- 自动计算用户四柱八字（年柱、月柱、日柱、时柱）
- 分析日主五行属性和八字平衡
- 提供性格、事业、健康、财运等多维度分析
- 计算大运信息，预测人生重要时期

### 2. 今日运势计算
- 基于八字与今日干支的相性分析
- 提供综合运势评分（1-100分）
- 分析事业、财运、健康、人际关系、学习等各维度运势
- 生成吉利方位、颜色、数字等实用信息
- 提供时辰建议和活动推荐

### 3. 个性化对话
- 根据用户八字特点调整回复风格
- 结合今日运势提供精准建议
- 情感分析，理解用户情绪状态
- 多种神仙角色选择，各有专长
- 提供个性化建议和吉利信息

## 使用方法

### 1. 访问个性化对话页面
- 在导航菜单中点击"个性化对话"
- 或直接访问：`http://localhost:5173/#?page=personalized-chat`

### 2. 填写个人信息
首次使用需要填写以下信息：
- **姓名**：您的真实姓名
- **出生日期时间**：精确到小时分钟
- **性别**：男/女

### 3. 选择神仙朋友
系统提供5位神仙角色：
- **观音菩萨**：慈悲与智慧，适合情感和心灵问题
- **文殊菩萨**：智慧与学习，适合学业和事业问题
- **弥勒佛**：欢喜与包容，适合心态和人际关系
- **地藏王菩萨**：坚毅与护佑，适合困难和挑战
- **太上老君**：道法与自然，适合哲学和人生问题

### 4. 开始对话
- 直接输入您的问题或困扰
- 使用快捷回复功能
- 请求特定类型的智慧或祝福
- 系统会根据您的八字和运势提供个性化回复

## 技术架构

### 前端组件
```
PersonalizedDeityFriend.tsx    # 主要聊天组件
PersonalizedChatPage.tsx       # 聊天页面
PersonalizedChatTestPage.tsx   # 功能测试页面
```

### 后端API
```
/api/calculate-bazi            # 八字计算API
/api/calculate-daily-fortune   # 今日运势API
```

### 核心服务
```
BaziService                    # 八字计算服务
DailyFortuneService           # 运势计算服务
```

## 个性化算法

### 1. 八字分析算法
```python
# 使用sxtwl库计算四柱
lunar = sxtwl.Lunar()
day_info = lunar.getDayBySolar(year, month, day)

# 手动计算时柱
shi_index = (hour + 1) // 2
shi_stem_index = (day_stem_index * 2 + shi_index) % 10
```

### 2. 运势计算算法
```python
# 五行相性计算
if is_generating(today_element, user_element):
    score += 20  # 相生
elif is_controlling(today_element, user_element):
    score -= 15  # 相克
```

### 3. 个性化回复生成
```javascript
// 基于八字特点
if (userInfo?.bazi?.day_master) {
    response += `根据你的日主${day_master}，`;
}

// 基于今日运势
if (userInfo?.dailyFortune?.overall_level) {
    response += `今日运势${overall_level}，`;
}
```

## 功能测试

### 1. API测试页面
访问：`http://localhost:5173/#?page=personalized-chat-test`

测试内容：
- 八字计算API连接
- 今日运势API连接
- 数据格式验证
- 错误处理机制

### 2. 测试用例
```javascript
// 测试用户信息
{
  name: "测试用户",
  birthdate: "1990-01-01T12:00",
  gender: "male"
}
```

## 数据存储

### 1. 本地存储
- 用户基本信息存储在localStorage
- 避免重复输入个人信息
- 支持数据持久化

### 2. 数据安全
- 个人信息仅存储在本地
- 不向第三方服务器传输敏感数据
- 支持数据清除功能

## 界面设计

### 1. 设计风格
- 禅意风格，符合传统文化
- 响应式设计，支持移动端
- 优雅的动画效果
- 直观的用户交互

### 2. 色彩系统
- 五行色彩：木绿、火红、土黄、金白、水黑
- 主题色：金色（var(--earth-golden)）
- 背景：渐变禅意（var(--gradient-zen-mist)）

## 扩展功能

### 1. 历史对话记录
- 保存对话历史
- 支持对话搜索
- 重要对话标记

### 2. 运势趋势分析
- 多日运势对比
- 运势变化趋势
- 重要日期提醒

### 3. 个性化设置
- 神仙偏好设置
- 回复风格调整
- 通知设置

### 4. 社交功能
- 分享运势结果
- 好友运势对比
- 社区讨论

## 故障排除

### 1. 常见问题
- **API连接失败**：检查后端服务是否启动
- **八字计算错误**：验证出生日期格式
- **运势数据异常**：检查网络连接
- **界面显示问题**：清除浏览器缓存

### 2. 调试方法
- 打开浏览器开发者工具
- 查看Console错误信息
- 检查Network请求状态
- 验证API响应格式

## 更新日志

### v1.0.0 (2024-01-15)
- 初始版本发布
- 基础八字计算功能
- 今日运势计算功能
- 个性化对话功能
- 5位神仙角色
- 响应式界面设计

## 技术支持

如有问题或建议，请联系开发团队：
- 邮箱：support@divine-friend.com
- 文档：https://docs.divine-friend.com
- 社区：https://community.divine-friend.com 

## 功能概述

个性化神仙对话功能是基于用户的八字信息、今日运势和个人特征，与AI神仙进行智能对话的系统。系统会根据用户的出生信息计算八字，结合当前日期计算今日运势，从而提供个性化的智慧指导和建议。

## 核心特性

### 1. 八字分析集成
- 自动计算用户四柱八字（年柱、月柱、日柱、时柱）
- 分析日主五行属性和八字平衡
- 提供性格、事业、健康、财运等多维度分析
- 计算大运信息，预测人生重要时期

### 2. 今日运势计算
- 基于八字与今日干支的相性分析
- 提供综合运势评分（1-100分）
- 分析事业、财运、健康、人际关系、学习等各维度运势
- 生成吉利方位、颜色、数字等实用信息
- 提供时辰建议和活动推荐

### 3. 个性化对话
- 根据用户八字特点调整回复风格
- 结合今日运势提供精准建议
- 情感分析，理解用户情绪状态
- 多种神仙角色选择，各有专长
- 提供个性化建议和吉利信息

## 使用方法

### 1. 访问个性化对话页面
- 在导航菜单中点击"个性化对话"
- 或直接访问：`http://localhost:5173/#?page=personalized-chat`

### 2. 填写个人信息
首次使用需要填写以下信息：
- **姓名**：您的真实姓名
- **出生日期时间**：精确到小时分钟
- **性别**：男/女

### 3. 选择神仙朋友
系统提供5位神仙角色：
- **观音菩萨**：慈悲与智慧，适合情感和心灵问题
- **文殊菩萨**：智慧与学习，适合学业和事业问题
- **弥勒佛**：欢喜与包容，适合心态和人际关系
- **地藏王菩萨**：坚毅与护佑，适合困难和挑战
- **太上老君**：道法与自然，适合哲学和人生问题

### 4. 开始对话
- 直接输入您的问题或困扰
- 使用快捷回复功能
- 请求特定类型的智慧或祝福
- 系统会根据您的八字和运势提供个性化回复

## 技术架构

### 前端组件
```
PersonalizedDeityFriend.tsx    # 主要聊天组件
PersonalizedChatPage.tsx       # 聊天页面
PersonalizedChatTestPage.tsx   # 功能测试页面
```

### 后端API
```
/api/calculate-bazi            # 八字计算API
/api/calculate-daily-fortune   # 今日运势API
```

### 核心服务
```
BaziService                    # 八字计算服务
DailyFortuneService           # 运势计算服务
```

## 个性化算法

### 1. 八字分析算法
```python
# 使用sxtwl库计算四柱
lunar = sxtwl.Lunar()
day_info = lunar.getDayBySolar(year, month, day)

# 手动计算时柱
shi_index = (hour + 1) // 2
shi_stem_index = (day_stem_index * 2 + shi_index) % 10
```

### 2. 运势计算算法
```python
# 五行相性计算
if is_generating(today_element, user_element):
    score += 20  # 相生
elif is_controlling(today_element, user_element):
    score -= 15  # 相克
```

### 3. 个性化回复生成
```javascript
// 基于八字特点
if (userInfo?.bazi?.day_master) {
    response += `根据你的日主${day_master}，`;
}

// 基于今日运势
if (userInfo?.dailyFortune?.overall_level) {
    response += `今日运势${overall_level}，`;
}
```

## 功能测试

### 1. API测试页面
访问：`http://localhost:5173/#?page=personalized-chat-test`

测试内容：
- 八字计算API连接
- 今日运势API连接
- 数据格式验证
- 错误处理机制

### 2. 测试用例
```javascript
// 测试用户信息
{
  name: "测试用户",
  birthdate: "1990-01-01T12:00",
  gender: "male"
}
```

## 数据存储

### 1. 本地存储
- 用户基本信息存储在localStorage
- 避免重复输入个人信息
- 支持数据持久化

### 2. 数据安全
- 个人信息仅存储在本地
- 不向第三方服务器传输敏感数据
- 支持数据清除功能

## 界面设计

### 1. 设计风格
- 禅意风格，符合传统文化
- 响应式设计，支持移动端
- 优雅的动画效果
- 直观的用户交互

### 2. 色彩系统
- 五行色彩：木绿、火红、土黄、金白、水黑
- 主题色：金色（var(--earth-golden)）
- 背景：渐变禅意（var(--gradient-zen-mist)）

## 扩展功能

### 1. 历史对话记录
- 保存对话历史
- 支持对话搜索
- 重要对话标记

### 2. 运势趋势分析
- 多日运势对比
- 运势变化趋势
- 重要日期提醒

### 3. 个性化设置
- 神仙偏好设置
- 回复风格调整
- 通知设置

### 4. 社交功能
- 分享运势结果
- 好友运势对比
- 社区讨论

## 故障排除

### 1. 常见问题
- **API连接失败**：检查后端服务是否启动
- **八字计算错误**：验证出生日期格式
- **运势数据异常**：检查网络连接
- **界面显示问题**：清除浏览器缓存

### 2. 调试方法
- 打开浏览器开发者工具
- 查看Console错误信息
- 检查Network请求状态
- 验证API响应格式

## 更新日志

### v1.0.0 (2024-01-15)
- 初始版本发布
- 基础八字计算功能
- 今日运势计算功能
- 个性化对话功能
- 5位神仙角色
- 响应式界面设计

## 技术支持

如有问题或建议，请联系开发团队：
- 邮箱：support@divine-friend.com
- 文档：https://docs.divine-friend.com
- 社区：https://community.divine-friend.com 