import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useAnalytics } from '../hooks/useAnalytics';

interface BraceletPageOptimizedProps {
  onNavigate: (page: string) => void;
}

interface BraceletInfo {
  id: string;
  owner: string;
  chipId: string;
  material: string;
  beadCount: number;
  imageUrl?: string;
  energyLevel: number;
  consecrationDate?: string;
  consecrationTemple?: string;
  consecrationMaster?: string;
  consecrationVideo?: string;
}

interface MeritRecord {
  count: number;
  dailyCount: number;
  totalDays: number;
}

interface MeritLevel {
  level: string;
  color: string;
  progress: number;
  nextLevelAt: number;
}

const BraceletPageOptimized: React.FC<BraceletPageOptimizedProps> = ({ onNavigate }) => {
  const [braceletInfo, setBraceletInfo] = useState<BraceletInfo | null>(null);
  const [meritRecord, setMeritRecord] = useState<MeritRecord | null>(null);
  const [status, setStatus] = useState<'connected' | 'disconnected' | 'verifying' | 'error'>('disconnected');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  // È™åËØÅÁõ∏ÂÖ≥Áä∂ÊÄÅ
  const [braceletIdInput, setBraceletIdInput] = useState('');
  const [showVerificationModal, setShowVerificationModal] = useState(false);
  const [verificationMethod, setVerificationMethod] = useState<'manual' | 'nfc' | 'qr'>('manual');
  const [isVerifying, setIsVerifying] = useState(false);
  
  // ÂøÉÁªè‰øÆÊåÅÁõ∏ÂÖ≥Áä∂ÊÄÅ
  const [sutraPlaying, setSutraPlaying] = useState(false);
  const [showSutraText, setShowSutraText] = useState(false);
  const [showSutraVideo, setShowSutraVideo] = useState(false);
  const [isVideoPlaying, setIsVideoPlaying] = useState(false);
  
  // ËÉΩÈáèÂàÜÊûêÁõ∏ÂÖ≥Áä∂ÊÄÅ
  const [showEnergyDetails, setShowEnergyDetails] = useState(false);
  
  // ÂºÄÂÖâËßÜÈ¢ëÁõ∏ÂÖ≥Áä∂ÊÄÅ
  const [showConsecrationVideo, setShowConsecrationVideo] = useState(false);
  
  // üìä ÂàÜÊûêËøΩË∏™
  const analytics = useAnalytics();

  // ÂøÉÁªèÊñáÊú¨
  const sutraText = `
    ËßÇËá™Âú®Ëè©Ëê®ÔºåË°åÊ∑±Ëà¨Ëã•Ê≥¢ÁΩóËúúÂ§öÊó∂ÔºåÁÖßËßÅ‰∫îËï¥ÁöÜÁ©∫ÔºåÂ∫¶‰∏ÄÂàáËã¶ÂéÑ„ÄÇ
    ËàçÂà©Â≠êÔºåËâ≤‰∏çÂºÇÁ©∫ÔºåÁ©∫‰∏çÂºÇËâ≤ÔºõËâ≤Âç≥ÊòØÁ©∫ÔºåÁ©∫Âç≥ÊòØËâ≤ÔºõÂèóÊÉ≥Ë°åËØÜÔºå‰∫¶Â§çÂ¶ÇÊòØ„ÄÇ
    ËàçÂà©Â≠êÔºåÊòØËØ∏Ê≥ïÁ©∫Áõ∏Ôºå‰∏çÁîü‰∏çÁÅ≠Ôºå‰∏çÂû¢‰∏çÂáÄÔºå‰∏çÂ¢û‰∏çÂáè„ÄÇ
    ÊòØÊïÖÁ©∫‰∏≠Êó†Ëâ≤ÔºåÊó†ÂèóÊÉ≥Ë°åËØÜÔºõÊó†ÁúºËÄ≥ÈºªËàåË∫´ÊÑèÔºåÊó†Ëâ≤Â£∞È¶ôÂë≥Ëß¶Ê≥ïÔºõ
    Êó†ÁúºÁïåÔºå‰πÉËá≥Êó†ÊÑèËØÜÁïåÔºõÊó†Êó†ÊòéÔºå‰∫¶Êó†Êó†ÊòéÂ∞ΩÔºå‰πÉËá≥Êó†ËÄÅÊ≠ªÔºå‰∫¶Êó†ËÄÅÊ≠ªÂ∞ΩÔºõ
    Êó†Ëã¶ÈõÜÁÅ≠ÈÅìÔºåÊó†Êô∫‰∫¶Êó†ÂæóÔºå‰ª•Êó†ÊâÄÂæóÊïÖÔºåËè©ÊèêËê®ÂüµÔºå‰æùËà¨Ëã•Ê≥¢ÁΩóËúúÂ§öÊïÖÔºå
    ÂøÉÊó†ÁΩ£Á¢çÔºåÊó†ÁΩ£Á¢çÊïÖÔºåÊó†ÊúâÊÅêÊÄñÔºåËøúÁ¶ªÈ¢†ÂÄíÊ¢¶ÊÉ≥ÔºåÁ©∂Á´üÊ∂ÖÊßÉ„ÄÇ
    ‰∏â‰∏ñËØ∏‰ΩõÔºå‰æùËà¨Ëã•Ê≥¢ÁΩóËúúÂ§öÊïÖÔºåÂæóÈòøËÄ®Â§öÁΩó‰∏âËóê‰∏âËè©Êèê„ÄÇ
    ÊïÖÁü•Ëà¨Ëã•Ê≥¢ÁΩóËúúÂ§öÔºåÊòØÂ§ßÁ•ûÂííÔºåÊòØÂ§ßÊòéÂííÔºåÊòØÊó†‰∏äÂííÔºåÊòØÊó†Á≠âÁ≠âÂííÔºå
    ËÉΩÈô§‰∏ÄÂàáËã¶ÔºåÁúüÂÆû‰∏çËôö„ÄÇ
    ÊïÖËØ¥Ëà¨Ëã•Ê≥¢ÁΩóËúúÂ§öÂííÔºåÂç≥ËØ¥ÂííÊõ∞ÔºöÊè≠Ë∞õÔºåÊè≠Ë∞õÔºåÊ≥¢ÁΩóÊè≠Ë∞õÔºåÊ≥¢ÁΩóÂÉßÊè≠Ë∞õÔºåËè©ÊèêËê®Â©ÜËØÉ„ÄÇ
  `;

  // Ê®°ÊãüÊï∞ÊçÆ
  const mockBraceletInfo: BraceletInfo = {
    id: 'BR001',
    owner: 'Âº†‰∏â',
    chipId: 'CHIP-2024-001',
    material: 'Â∞èÂè∂Á¥´Ê™Ä',
    beadCount: 108,
    energyLevel: 85,
    consecrationDate: '2024Âπ¥1Êúà15Êó•',
    consecrationTemple: 'ÁÅµÈöêÂØ∫',
    consecrationMaster: 'ÊÖßÊòéÊ≥ïÂ∏à',
    consecrationVideo: 'https://ssswork.oss-cn-hangzhou.aliyuncs.com/jss/669_raw.mp4'
  };

  const mockMeritRecord: MeritRecord = {
    count: 1248,
    dailyCount: 73,
    totalDays: 45
  };

  // Ëé∑ÂèñÁä∂ÊÄÅÈ¢úËâ≤
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'connected': return '#10B981';
      case 'disconnected': return '#EF4444';
      case 'verifying': return '#F59E0B';
      case 'error': return '#DC2626';
      default: return '#6B7280';
    }
  };

  // Ëé∑ÂèñÁä∂ÊÄÅÊñáÊú¨
  const getStatusText = (status: string) => {
    switch (status) {
      case 'connected': return 'Â∑≤ËøûÊé•';
      case 'disconnected': return 'Êú™ËøûÊé•';
      case 'verifying': return 'È™åËØÅ‰∏≠';
      case 'error': return 'ËøûÊé•ÈîôËØØ';
      default: return 'Êú™Áü•Áä∂ÊÄÅ';
    }
  };

  // Ëé∑ÂèñÂäüÂæ∑Á≠âÁ∫ß
  const getMeritLevel = (): MeritLevel | null => {
    if (!meritRecord) return null;
    
    const count = meritRecord.count;
    if (count < 100) {
      return {
        level: 'ÂàùÂøÉËÄÖ',
        color: '#10B981',
        progress: (count / 100) * 100,
        nextLevelAt: 100
      };
    } else if (count < 500) {
      return {
        level: '‰øÆË°åËÄÖ',
        color: '#3B82F6',
        progress: ((count - 100) / 400) * 100,
        nextLevelAt: 500
      };
    } else if (count < 1000) {
      return {
        level: 'ÂñÑË°åËÄÖ',
        color: '#8B5CF6',
        progress: ((count - 500) / 500) * 100,
        nextLevelAt: 1000
      };
    } else if (count < 2000) {
      return {
        level: 'ÊÖàÊÇ≤ËÄÖ',
        color: '#F59E0B',
        progress: ((count - 1000) / 1000) * 100,
        nextLevelAt: 2000
      };
    } else {
      return {
        level: 'ËßâÊÇüËÄÖ',
        color: '#D4AF37',
        progress: 100,
        nextLevelAt: count
      };
    }
  };

  // È™åËØÅÊâã‰∏≤
  const handleVerifyBracelet = async () => {
    if (verificationMethod === 'manual' && !braceletIdInput.trim()) return;
    
    // ËøΩË∏™Êâã‰∏≤È™åËØÅ
    analytics.trackUserAction('bracelet_verification_started', {
      method: verificationMethod,
      hasInput: !!braceletIdInput.trim()
    });
    
    setIsVerifying(true);
    setError(null);
    
    try {
      // Ê®°ÊãüÈ™åËØÅËøáÁ®ã
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Ê®°ÊãüÈ™åËØÅÊàêÂäü
      setBraceletInfo(mockBraceletInfo);
      setMeritRecord(mockMeritRecord);
      setStatus('connected');
      setShowVerificationModal(false);
      setBraceletIdInput('');
      
      // ËøΩË∏™È™åËØÅÊàêÂäü
      analytics.trackUserAction('bracelet_verification_success', {
        method: verificationMethod,
        braceletId: mockBraceletInfo.id,
        material: mockBraceletInfo.material
      });
      
      // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
      localStorage.setItem('braceletActivated', 'true');
      localStorage.setItem('braceletInfo', JSON.stringify(mockBraceletInfo));
      localStorage.setItem('meritRecord', JSON.stringify(mockMeritRecord));
      
    } catch (error) {
      setError('È™åËØÅÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êâã‰∏≤ÁºñÂè∑ÊòØÂê¶Ê≠£Á°Æ');
      if (error instanceof Error) {
        analytics.trackError(error, 'bracelet_verification_failed');
      }
    } finally {
      setIsVerifying(false);
    }
  };

  // NFCÈ™åËØÅ
  const handleNFCVerification = async () => {
    setVerificationMethod('nfc');
    setIsVerifying(true);
    setError(null);
    
    try {
      // Ê®°ÊãüNFCËØªÂèñ
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Ê®°ÊãüÊàêÂäü
      setBraceletInfo(mockBraceletInfo);
      setMeritRecord(mockMeritRecord);
      setStatus('connected');
      
      localStorage.setItem('braceletActivated', 'true');
      localStorage.setItem('braceletInfo', JSON.stringify(mockBraceletInfo));
      localStorage.setItem('meritRecord', JSON.stringify(mockMeritRecord));
      
    } catch (error) {
      setError('NFCËØªÂèñÂ§±Ë¥•ÔºåËØ∑Á°Æ‰øùÊâã‰∏≤Èù†ËøëÊâãÊú∫');
    } finally {
      setIsVerifying(false);
    }
  };

  // Êâ´Á†ÅÈ™åËØÅ
  const handleQRVerification = async () => {
    setVerificationMethod('qr');
    setIsVerifying(true);
    setError(null);
    
    try {
      // Ê®°ÊãüÊâ´Á†Å
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // Ê®°ÊãüÊàêÂäü
      setBraceletInfo(mockBraceletInfo);
      setMeritRecord(mockMeritRecord);
      setStatus('connected');
      
      localStorage.setItem('braceletActivated', 'true');
      localStorage.setItem('braceletInfo', JSON.stringify(mockBraceletInfo));
      localStorage.setItem('meritRecord', JSON.stringify(mockMeritRecord));
      
    } catch (error) {
      setError('Êâ´Á†ÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
    } finally {
      setIsVerifying(false);
    }
  };

  // ÂÆåÊàê‰øÆÊåÅ
  const handleCompletePractice = () => {
    if (!meritRecord) return;
    
    // ËøΩË∏™‰øÆÊåÅÂÆåÊàê
    analytics.trackUserAction('practice_completed', {
      previousCount: meritRecord.count,
      previousDailyCount: meritRecord.dailyCount,
      practiceType: sutraPlaying ? 'sutra' : 'video'
    });
    
    const newMeritRecord = {
      ...meritRecord,
      count: meritRecord.count + 1,
      dailyCount: meritRecord.dailyCount + 1
    };
    
    setMeritRecord(newMeritRecord);
    setSutraPlaying(false);
    setIsVideoPlaying(false);
    
    // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
    localStorage.setItem('meritRecord', JSON.stringify(newMeritRecord));
    
    // ÈúáÂä®ÂèçÈ¶à
    if ('vibrate' in navigator) {
      navigator.vibrate([100, 50, 100, 50, 100]);
    }
  };

  // Â§ÑÁêÜËßÜÈ¢ëÊí≠Êîæ/ÊöÇÂÅú
  const handleVideoToggle = () => {
    setIsVideoPlaying(!isVideoPlaying);
    setSutraPlaying(!isVideoPlaying);
  };

  // Â§ÑÁêÜËßÜÈ¢ëÁªìÊùü
  const handleVideoEnded = () => {
    setIsVideoPlaying(false);
    setSutraPlaying(false);
  };

  // Âà∑Êñ∞Áä∂ÊÄÅ
  const refreshStatus = async () => {
    setLoading(true);
    try {
      await new Promise(resolve => setTimeout(resolve, 1000));
      // Ê®°ÊãüÁä∂ÊÄÅÂà∑Êñ∞
      setStatus('connected');
    } catch (error) {
      setStatus('error');
    } finally {
      setLoading(false);
    }
  };

  // Âä†ËΩΩÁé∞ÊúâÊï∞ÊçÆ
  useEffect(() => {
    // ËøΩË∏™Êâã‰∏≤È°µÈù¢ËÆøÈóÆ
    analytics.trackPageView('bracelet', 'Êâã‰∏≤Áä∂ÊÄÅ');
    analytics.trackEvent('bracelet_page_load');
    
    const loadExistingData = async () => {
      const isActivated = localStorage.getItem('braceletActivated') === 'true';
      
      if (isActivated) {
        try {
          const savedBraceletInfo = localStorage.getItem('braceletInfo');
          const savedMeritRecord = localStorage.getItem('meritRecord');
          
          if (savedBraceletInfo) {
            setBraceletInfo(JSON.parse(savedBraceletInfo));
          }
          
          if (savedMeritRecord) {
            setMeritRecord(JSON.parse(savedMeritRecord));
          }
          
          setStatus('connected');
          analytics.trackEvent('bracelet_already_activated');
        } catch (error) {
          console.error('Âä†ËΩΩÊâã‰∏≤Êï∞ÊçÆÂ§±Ë¥•:', error);
          if (error instanceof Error) {
            analytics.trackError(error, 'bracelet_load_data');
          }
        }
      } else {
        analytics.trackEvent('bracelet_not_activated');
      }
    };

    loadExistingData();
  }, [analytics]);

  // Â¶ÇÊûúÊ≤°ÊúâÊâã‰∏≤‰ø°ÊÅØÔºåÊòæÁ§∫È™åËØÅÁïåÈù¢
  if (!braceletInfo) {
    return (
      <div style={{
        minHeight: '100vh',
        background: 'var(--zen-bg-primary)',
        position: 'relative'
      }}>
        {/* ËÉåÊôØË£ÖÈ•∞ */}
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'radial-gradient(circle at 30% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%)',
          zIndex: -1
        }} />

        <div style={{
          padding: 'var(--zen-space-2xl) var(--zen-space-lg)',
          maxWidth: '500px',
          margin: '0 auto',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          minHeight: '100vh'
        }}>
          <motion.div
            initial={{ y: -20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            className="zen-card"
            style={{ width: '100%' }}
          >
            <div className="zen-text-center zen-mb-2xl">
              <motion.div
                animate={{ scale: [1, 1.1, 1] }}
                transition={{ duration: 3, repeat: Infinity }}
                style={{ fontSize: '4rem', marginBottom: 'var(--zen-space-lg)' }}
              >
                üìø
              </motion.div>
              
              <h1 style={{
                fontSize: 'var(--zen-text-3xl)',
                fontWeight: 700,
                color: 'var(--zen-text-primary)',
                marginBottom: 'var(--zen-space-lg)'
              }}>
                ÊàëÁöÑÊ≥ïÂÆùÊâã‰∏≤
              </h1>
              
              <p style={{
                fontSize: 'var(--zen-text-base)',
                color: 'var(--zen-text-secondary)',
                lineHeight: 1.6
              }}>
                È™åËØÅÊÇ®ÁöÑÂºÄÂÖâÊâã‰∏≤ÔºåÂºÄÂêØ‰øÆË°å‰πãË∑Ø
              </p>
            </div>

            {error && (
              <motion.div
                initial={{ opacity: 0, y: -10 }}
                animate={{ opacity: 1, y: 0 }}
                style={{
                  background: 'var(--zen-error-alpha)',
                  border: '1px solid var(--zen-error)',
                  borderRadius: 'var(--zen-radius-lg)',
                  padding: 'var(--zen-space-lg)',
                  marginBottom: 'var(--zen-space-xl)',
                  color: 'var(--zen-error-light)',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 'var(--zen-space-sm)'
                }}
              >
                <span>‚ö†Ô∏è</span>
                <span>{error}</span>
                <button
                  onClick={() => setError(null)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: 'inherit',
                    cursor: 'pointer',
                    marginLeft: 'auto'
                  }}
                >
                  ‚úï
                </button>
              </motion.div>
            )}

            <div className="zen-form-group">
              <label className="zen-label zen-label-required">Êâã‰∏≤ÁºñÂè∑</label>
              <input
                type="text"
                value={braceletIdInput}
                onChange={(e) => setBraceletIdInput(e.target.value)}
                placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÊâã‰∏≤ÁºñÂè∑"
                className="zen-input"
                disabled={isVerifying}
              />
            </div>

            <motion.button
              className="zen-btn zen-btn-primary zen-btn-lg"
              onClick={handleVerifyBracelet}
              disabled={isVerifying || !braceletIdInput.trim()}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              style={{
                width: '100%',
                marginBottom: 'var(--zen-space-xl)',
                opacity: (!braceletIdInput.trim() || isVerifying) ? 0.5 : 1
              }}
            >
              {isVerifying ? (
                <div className="zen-flex zen-items-center zen-gap-md">
                  <motion.div
                    animate={{ rotate: 360 }}
                    transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                  >
                    ‚è≥
                  </motion.div>
                  È™åËØÅ‰∏≠...
                </div>
              ) : (
                'È™åËØÅÊâã‰∏≤'
              )}
            </motion.button>

            <div style={{ marginBottom: 'var(--zen-space-xl)' }}>
              <p style={{
                fontSize: 'var(--zen-text-sm)',
                color: 'var(--zen-text-tertiary)',
                textAlign: 'center',
                marginBottom: 'var(--zen-space-lg)'
              }}>
                ÂÖ∂‰ªñÈ™åËØÅÊñπÂºè
              </p>
              
              <div style={{
                display: 'grid',
                gridTemplateColumns: '1fr 1fr',
                gap: 'var(--zen-space-lg)'
              }}>
                <motion.button
                  className="zen-btn zen-btn-secondary"
                  onClick={handleNFCVerification}
                  disabled={isVerifying}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  style={{
                    opacity: isVerifying ? 0.5 : 1
                  }}
                >
                  <div className="zen-flex zen-flex-col zen-items-center zen-gap-sm">
                    <span style={{ fontSize: '1.5rem' }}>üì±</span>
                    <span style={{ fontSize: 'var(--zen-text-sm)' }}>NFCÊÑüÂ∫î</span>
                    <small style={{ fontSize: 'var(--zen-text-xs)' }}>
                      {isVerifying && verificationMethod === 'nfc' ? 'ËØªÂèñ‰∏≠...' : 'Âø´ÈÄüÈ™åËØÅ'}
                    </small>
                  </div>
                </motion.button>
                
                <motion.button
                  className="zen-btn zen-btn-secondary"
                  onClick={handleQRVerification}
                  disabled={isVerifying}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  style={{
                    opacity: isVerifying ? 0.5 : 1
                  }}
                >
                  <div className="zen-flex zen-flex-col zen-items-center zen-gap-sm">
                    <span style={{ fontSize: '1.5rem' }}>üì∑</span>
                    <span style={{ fontSize: 'var(--zen-text-sm)' }}>Êâ´Á†ÅÈ™åËØÅ</span>
                    <small style={{ fontSize: 'var(--zen-text-xs)' }}>
                      {isVerifying && verificationMethod === 'qr' ? 'Êâ´Êèè‰∏≠...' : 'Êâ´Á†ÅËØÜÂà´'}
                    </small>
                  </div>
                </motion.button>
              </div>
            </div>

            <div style={{
              background: 'var(--zen-info-alpha)',
              border: '1px solid var(--zen-info)',
              borderRadius: 'var(--zen-radius-lg)',
              padding: 'var(--zen-space-lg)',
              color: 'var(--zen-info-light)',
              fontSize: 'var(--zen-text-sm)',
              textAlign: 'center'
            }}>
              üí° ËØ∑Á°Æ‰øùÊâã‰∏≤Â∑≤ÂºÄÂÖâÔºåÈ™åËØÅÂêéÂèØËé∑ÂæóËè©Ëê®Âä†ÊåÅ
            </div>
          </motion.div>
        </div>
      </div>
    );
  }

  const meritLevel = getMeritLevel();

  return (
    <div style={{
      minHeight: '100vh',
      background: 'var(--zen-bg-primary)',
      position: 'relative'
    }}>
      {/* ËÉåÊôØË£ÖÈ•∞ */}
      <div style={{
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        background: 'radial-gradient(circle at 30% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%)',
        zIndex: -1
      }} />

      <div style={{
        padding: 'var(--zen-space-2xl) var(--zen-space-lg)',
        maxWidth: '500px',
        margin: '0 auto'
      }}>
        {/* Ê†áÈ¢òÂå∫Âüü */}
        <motion.div
          initial={{ y: -20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          className="zen-text-center zen-mb-2xl"
        >
          <motion.div
            animate={{ rotate: [0, 10, -10, 0] }}
            transition={{ duration: 4, repeat: Infinity }}
            style={{ fontSize: '3rem', marginBottom: 'var(--zen-space-lg)' }}
          >
            üìø
          </motion.div>
          
          <h1 style={{
            fontSize: 'var(--zen-text-3xl)',
            fontWeight: 700,
            color: 'var(--zen-text-primary)',
            marginBottom: 'var(--zen-space-sm)'
          }}>
            ÊàëÁöÑÁ•û‰ªôÊâã‰∏≤
          </h1>
          
          <div className="zen-flex zen-items-center zen-justify-center zen-gap-lg">
            <div className="zen-status" style={{
              background: getStatusColor(status) + '20',
              color: getStatusColor(status)
            }}>
              <span style={{
                width: '8px',
                height: '8px',
                background: getStatusColor(status),
                borderRadius: '50%',
                marginRight: 'var(--zen-space-sm)'
              }} />
              {getStatusText(status)}
            </div>
          </div>
        </motion.div>

        {/* Êâã‰∏≤Áä∂ÊÄÅÂç°Áâá */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="zen-card zen-mb-xl"
        >
          <div className="zen-flex zen-items-center zen-gap-lg">
            <div style={{ position: 'relative' }}>
              {braceletInfo.imageUrl ? (
                <img
                  src={braceletInfo.imageUrl}
                  alt={`${braceletInfo.owner}ÁöÑÊâã‰∏≤`}
                  style={{
                    width: '80px',
                    height: '80px',
                    borderRadius: 'var(--zen-radius-lg)',
                    objectFit: 'cover'
                  }}
                />
              ) : (
                <div style={{
                  width: '80px',
                  height: '80px',
                  background: 'var(--zen-bg-glass)',
                  borderRadius: 'var(--zen-radius-lg)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '2rem',
                  border: '2px solid var(--zen-border-normal)'
                }}>
                  üìø
                </div>
              )}
              
              <div
                style={{
                  position: 'absolute',
                  top: '-4px',
                  right: '-4px',
                  width: '20px',
                  height: '20px',
                  background: getStatusColor(status),
                  borderRadius: '50%',
                  border: '2px solid var(--zen-bg-primary)'
                }}
              />
            </div>
            
            <div style={{ flex: 1 }}>
              <h3 style={{
                fontSize: 'var(--zen-text-lg)',
                fontWeight: 600,
                color: 'var(--zen-text-primary)',
                marginBottom: 'var(--zen-space-sm)'
              }}>
                {braceletInfo.owner}ÁöÑÊ≥ïÂÆù
              </h3>
              
              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(3, 1fr)',
                gap: 'var(--zen-space-sm)',
                fontSize: 'var(--zen-text-xs)'
              }}>
                <div>
                  <div style={{ color: 'var(--zen-text-tertiary)' }}>ËäØÁâáÁºñÂè∑</div>
                  <div style={{ color: 'var(--zen-text-primary)', fontWeight: 500 }}>
                    {braceletInfo.chipId}
                  </div>
                </div>
                <div>
                  <div style={{ color: 'var(--zen-text-tertiary)' }}>ÊùêË¥®</div>
                  <div style={{ color: 'var(--zen-text-primary)', fontWeight: 500 }}>
                    {braceletInfo.material}
                  </div>
                </div>
                <div>
                  <div style={{ color: 'var(--zen-text-tertiary)' }}>‰ΩõÁè†</div>
                  <div style={{ color: 'var(--zen-text-primary)', fontWeight: 500 }}>
                    {braceletInfo.beadCount}È¢ó
                  </div>
                </div>
              </div>
            </div>
            
            <motion.button
              onClick={refreshStatus}
              whileHover={{ scale: 1.1 }}
              whileTap={{ scale: 0.9 }}
              style={{
                background: 'none',
                border: 'none',
                color: 'var(--zen-text-tertiary)',
                cursor: 'pointer',
                fontSize: '1.2rem'
              }}
              disabled={loading}
            >
              {loading ? (
                <motion.div
                  animate={{ rotate: 360 }}
                  transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                >
                  ‚è≥
                </motion.div>
              ) : (
                'üîÑ'
              )}
            </motion.button>
          </div>
        </motion.div>

        {/* ËÉΩÈáèÁä∂ÊÄÅÂàÜÊûê */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.1 }}
          className="zen-card zen-mb-xl"
        >
          <div className="zen-flex zen-justify-between zen-items-center zen-mb-lg">
            <h3 style={{
              fontSize: 'var(--zen-text-lg)',
              fontWeight: 600,
              color: 'var(--zen-text-primary)'
            }}>
              ËÉΩÈáèÁä∂ÊÄÅÂàÜÊûê
            </h3>
            
            <button
              onClick={() => setShowEnergyDetails(!showEnergyDetails)}
              className="zen-btn zen-btn-ghost zen-btn-sm"
            >
              {showEnergyDetails ? 'ÁÆÄÂåñ' : 'ËØ¶ÊÉÖ'}
            </button>
          </div>
          
          <div className="zen-flex zen-items-center zen-gap-lg">
            <div style={{ position: 'relative' }}>
              <svg width="80" height="80" style={{ transform: 'rotate(-90deg)' }}>
                <circle
                  cx="40"
                  cy="40"
                  r="35"
                  fill="none"
                  stroke="var(--zen-border-subtle)"
                  strokeWidth="6"
                />
                <motion.circle
                  cx="40"
                  cy="40"
                  r="35"
                  fill="none"
                  stroke="var(--zen-primary)"
                  strokeWidth="6"
                  strokeLinecap="round"
                  initial={{ strokeDasharray: '0 220' }}
                  animate={{ 
                    strokeDasharray: `${(braceletInfo.energyLevel / 100) * 220} 220` 
                  }}
                  transition={{ duration: 1, ease: "easeOut" }}
                />
              </svg>
              
              <div style={{
                position: 'absolute',
                top: '50%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                textAlign: 'center'
              }}>
                <div style={{
                  fontSize: 'var(--zen-text-lg)',
                  fontWeight: 700,
                  color: 'var(--zen-primary)'
                }}>
                  {braceletInfo.energyLevel}%
                </div>
                <div style={{
                  fontSize: 'var(--zen-text-xs)',
                  color: 'var(--zen-text-tertiary)'
                }}>
                  ËÉΩÈáè
                </div>
              </div>
            </div>
            
            <div style={{ flex: 1 }}>
              <div style={{
                fontSize: 'var(--zen-text-base)',
                color: 'var(--zen-text-secondary)',
                marginBottom: 'var(--zen-space-sm)'
              }}>
                {(() => {
                  const level = braceletInfo.energyLevel;
                  if (level >= 90) return '‚ú® ËÉΩÈáèÂÖÖÊ≤õÔºåÊ≥ïÂäõÂº∫Â§ß';
                  if (level >= 70) return 'üåü ËÉΩÈáèËâØÂ•ΩÔºåÁä∂ÊÄÅÁ®≥ÂÆö';
                  if (level >= 50) return 'üí´ ËÉΩÈáè‰∏≠Á≠âÔºåÈúÄË¶ÅË°•ÂÖÖ';
                  return 'üîã ËÉΩÈáè‰∏çË∂≥ÔºåÊÄ•ÈúÄÂÖÖËÉΩ';
                })()}
              </div>
              
              {showEnergyDetails && (
                <div style={{
                  background: 'var(--zen-bg-glass)',
                  borderRadius: 'var(--zen-radius-md)',
                  padding: 'var(--zen-space-md)',
                  fontSize: 'var(--zen-text-sm)',
                  color: 'var(--zen-text-tertiary)'
                }}>
                  <div>Ë∂ãÂäø: üìà ‰∏äÂçá</div>
                  <div>7Êó•Âπ≥Âùá: 82.3%</div>
                </div>
              )}
            </div>
          </div>
        </motion.div>

        {/* ÂäüÂæ∑ÊòæÁ§∫ */}
        {meritRecord && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="zen-card zen-mb-xl"
          >
            <div className="zen-flex zen-justify-between zen-items-center zen-mb-lg">
              <h3 style={{
                fontSize: 'var(--zen-text-lg)',
                fontWeight: 600,
                color: 'var(--zen-text-primary)'
              }}>
                ‰øÆË°åÂäüÂæ∑
              </h3>
              
              {meritLevel && (
                <div className="zen-status" style={{
                  background: meritLevel.color + '20',
                  color: meritLevel.color
                }}>
                  {meritLevel.level}
                </div>
              )}
            </div>
            
            <div style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(3, 1fr)',
              gap: 'var(--zen-space-lg)',
              marginBottom: 'var(--zen-space-lg)'
            }}>
              <div className="zen-text-center">
                <div style={{
                  fontSize: 'var(--zen-text-2xl)',
                  fontWeight: 700,
                  color: 'var(--zen-primary)',
                  marginBottom: 'var(--zen-space-xs)'
                }}>
                  {meritRecord.count}
                </div>
                <div style={{
                  fontSize: 'var(--zen-text-xs)',
                  color: 'var(--zen-text-tertiary)'
                }}>
                  ÊÄªÂäüÂæ∑
                </div>
              </div>
              
              <div className="zen-text-center">
                <div style={{
                  fontSize: 'var(--zen-text-2xl)',
                  fontWeight: 700,
                  color: 'var(--zen-success)',
                  marginBottom: 'var(--zen-space-xs)'
                }}>
                  {meritRecord.dailyCount}
                </div>
                <div style={{
                  fontSize: 'var(--zen-text-xs)',
                  color: 'var(--zen-text-tertiary)'
                }}>
                  ‰ªäÊó•‰øÆÊåÅ
                </div>
              </div>
              
              <div className="zen-text-center">
                <div style={{
                  fontSize: 'var(--zen-text-2xl)',
                  fontWeight: 700,
                  color: 'var(--zen-info)',
                  marginBottom: 'var(--zen-space-xs)'
                }}>
                  {meritRecord.totalDays}
                </div>
                <div style={{
                  fontSize: 'var(--zen-text-xs)',
                  color: 'var(--zen-text-tertiary)'
                }}>
                  ‰øÆË°åÂ§©Êï∞
                </div>
              </div>
            </div>

            {meritLevel && meritLevel.progress < 100 && (
              <div>
                <div style={{
                  fontSize: 'var(--zen-text-sm)',
                  color: 'var(--zen-text-secondary)',
                  marginBottom: 'var(--zen-space-sm)'
                }}>
                  Ë∑ùÁ¶ª‰∏ã‰∏ÄÁ∫ßËøòÈúÄ {meritLevel.nextLevelAt - meritRecord.count} ÂäüÂæ∑
                </div>
                
                <div style={{
                  background: 'var(--zen-bg-glass)',
                  borderRadius: 'var(--zen-radius-full)',
                  height: '8px',
                  overflow: 'hidden'
                }}>
                  <motion.div
                    initial={{ width: 0 }}
                    animate={{ width: `${meritLevel.progress}%` }}
                    transition={{ duration: 1, ease: "easeOut" }}
                    style={{
                      height: '100%',
                      background: `linear-gradient(90deg, ${meritLevel.color}, var(--zen-primary))`,
                      borderRadius: 'var(--zen-radius-full)'
                    }}
                  />
                </div>
              </div>
            )}
          </motion.div>
        )}

        {/* ‰øÆÊåÅÂøÉÁªè */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.3 }}
          className="zen-card zen-mb-xl"
        >
          <div className="zen-text-center zen-mb-lg">
            <h3 style={{
              fontSize: 'var(--zen-text-lg)',
              fontWeight: 600,
              color: 'var(--zen-text-primary)',
              marginBottom: 'var(--zen-space-sm)'
            }}>
              ‰øÆÊåÅÂøÉÁªè
            </h3>
            
            <p style={{
              fontSize: 'var(--zen-text-sm)',
              color: 'var(--zen-text-secondary)'
            }}>
              ËØµËØªÂøÉÁªèÔºåÂ¢ûÈïøÊô∫ÊÖßÔºåÁßØÁ¥ØÂäüÂæ∑
            </p>
          </div>

                     <AnimatePresence>
             {showSutraText && (
               <motion.div
                 initial={{ opacity: 0, height: 0 }}
                 animate={{ opacity: 1, height: 'auto' }}
                 exit={{ opacity: 0, height: 0 }}
                 style={{
                   background: 'var(--zen-bg-glass)',
                   borderRadius: 'var(--zen-radius-lg)',
                   padding: 'var(--zen-space-lg)',
                   marginBottom: 'var(--zen-space-lg)',
                   overflow: 'hidden'
                 }}
               >
                 <div style={{
                   fontSize: 'var(--zen-text-sm)',
                   color: 'var(--zen-text-secondary)',
                   lineHeight: 1.8,
                   whiteSpace: 'pre-line'
                 }}>
                   {sutraText.trim()}
                 </div>
               </motion.div>
             )}
           </AnimatePresence>

           <AnimatePresence>
             {showSutraVideo && (
               <motion.div
                 initial={{ opacity: 0, height: 0 }}
                 animate={{ opacity: 1, height: 'auto' }}
                 exit={{ opacity: 0, height: 0 }}
                 style={{
                   background: 'var(--zen-bg-glass)',
                   borderRadius: 'var(--zen-radius-lg)',
                   padding: 'var(--zen-space-lg)',
                   marginBottom: 'var(--zen-space-lg)',
                   overflow: 'hidden'
                 }}
               >
                 <div style={{
                   textAlign: 'center',
                   marginBottom: 'var(--zen-space-md)'
                 }}>
                   <h5 style={{
                     fontSize: 'var(--zen-text-base)',
                     fontWeight: 600,
                     color: 'var(--zen-text-primary)',
                     marginBottom: 'var(--zen-space-sm)'
                   }}>
                     üé• ÂøÉÁªèËØµËØªËßÜÈ¢ë
                   </h5>
                   <p style={{
                     fontSize: 'var(--zen-text-sm)',
                     color: 'var(--zen-text-secondary)'
                   }}>
                     Ë∑üÈöèÊ≥ïÂ∏à‰∏ÄËµ∑ËØµËØªÂøÉÁªèÔºåÊÑüÂèó‰ΩõÊ≥ïÁöÑÂ∫Ñ‰∏•‰∏éÊÖàÊÇ≤
                   </p>
                 </div>
                 
                 <div style={{
                   borderRadius: 'var(--zen-radius-lg)',
                   overflow: 'hidden',
                   background: '#000'
                 }}>
                   <video
                     controls
                     autoPlay={isVideoPlaying}
                     onEnded={handleVideoEnded}
                     style={{
                       width: '100%',
                       height: '200px',
                       objectFit: 'cover'
                     }}
                     poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMWEyMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuW/g+e7j+ivteivu+inhumikTwvdGV4dD48L3N2Zz4="
                   >
                     <source src="https://ssswork.oss-cn-hangzhou.aliyuncs.com/jss/669_raw.mp4" type="video/mp4" />
                     ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÊí≠Êîæ
                   </video>
                 </div>

                 <div style={{
                   background: 'var(--zen-info-alpha)',
                   border: '1px solid var(--zen-info)',
                   borderRadius: 'var(--zen-radius-md)',
                   padding: 'var(--zen-space-md)',
                   marginTop: 'var(--zen-space-md)',
                   color: 'var(--zen-info-light)',
                   fontSize: 'var(--zen-text-sm)',
                   textAlign: 'center'
                 }}>
                   üí° Âª∫ËÆÆ‰Ω©Êà¥ËÄ≥Êú∫ÔºåÂú®ÂÆâÈùôÁöÑÁéØÂ¢É‰∏≠ËßÇÁúãÔºåÊïàÊûúÊõ¥‰Ω≥
                 </div>
               </motion.div>
             )}
           </AnimatePresence>

                     <div style={{
             display: 'grid',
             gridTemplateColumns: 'repeat(3, 1fr)',
             gap: 'var(--zen-space-sm)',
             marginBottom: 'var(--zen-space-md)'
           }}>
             <button
               className="zen-btn zen-btn-secondary zen-btn-sm"
               onClick={() => setShowSutraText(!showSutraText)}
             >
               üìñ ÁªèÊñá
             </button>
             
             <button
               className="zen-btn zen-btn-secondary zen-btn-sm"
               onClick={() => setShowSutraVideo(!showSutraVideo)}
             >
               üé• ËßÜÈ¢ë
             </button>
             
             <button
               className={`zen-btn zen-btn-sm ${sutraPlaying || isVideoPlaying ? 'zen-btn-warning' : 'zen-btn-primary'}`}
               onClick={() => {
                 if (showSutraVideo && !isVideoPlaying) {
                   handleVideoToggle();
                 } else {
                   setSutraPlaying(!sutraPlaying);
                 }
               }}
             >
               {(sutraPlaying || isVideoPlaying) ? '‚è∏Ô∏è ÊöÇÂÅú' : '‚ñ∂Ô∏è ÂºÄÂßã'}
             </button>
           </div>
          
                     <motion.button
             className="zen-btn zen-btn-success"
             onClick={handleCompletePractice}
             disabled={!sutraPlaying && !isVideoPlaying}
             whileHover={{ scale: (sutraPlaying || isVideoPlaying) ? 1.02 : 1 }}
             whileTap={{ scale: (sutraPlaying || isVideoPlaying) ? 0.98 : 1 }}
             style={{
               width: '100%',
               opacity: (sutraPlaying || isVideoPlaying) ? 1 : 0.5
             }}
           >
             ‚úÖ ÂÆåÊàê‰øÆÊåÅ +1
           </motion.button>
        </motion.div>

        {/* ÂºÄÂÖâ‰ø°ÊÅØ */}
        {braceletInfo.consecrationDate && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
            className="zen-card zen-mb-xl"
          >
            <h3 style={{
              fontSize: 'var(--zen-text-lg)',
              fontWeight: 600,
              color: 'var(--zen-text-primary)',
              marginBottom: 'var(--zen-space-lg)'
            }}>
              ÂºÄÂÖâ‰ø°ÊÅØ
            </h3>
            
            <div style={{
              display: 'flex',
              flexDirection: 'column',
              gap: 'var(--zen-space-lg)'
            }}>
              <div className="zen-flex zen-items-center zen-gap-lg">
                <span style={{ fontSize: '1.5rem' }}>üìÖ</span>
                <div>
                  <div style={{
                    fontSize: 'var(--zen-text-xs)',
                    color: 'var(--zen-text-tertiary)',
                    marginBottom: 'var(--zen-space-xs)'
                  }}>
                    ÂºÄÂÖâÊó∂Èó¥
                  </div>
                  <div style={{
                    fontSize: 'var(--zen-text-base)',
                    color: 'var(--zen-text-primary)',
                    fontWeight: 500
                  }}>
                    {braceletInfo.consecrationDate}
                  </div>
                </div>
              </div>
              
              {braceletInfo.consecrationTemple && (
                <div className="zen-flex zen-items-center zen-gap-lg">
                  <span style={{ fontSize: '1.5rem' }}>üèõÔ∏è</span>
                  <div>
                    <div style={{
                      fontSize: 'var(--zen-text-xs)',
                      color: 'var(--zen-text-tertiary)',
                      marginBottom: 'var(--zen-space-xs)'
                    }}>
                      ÂºÄÂÖâÂØ∫Èô¢
                    </div>
                    <div style={{
                      fontSize: 'var(--zen-text-base)',
                      color: 'var(--zen-text-primary)',
                      fontWeight: 500
                    }}>
                      {braceletInfo.consecrationTemple}
                    </div>
                  </div>
                </div>
              )}
              
              {braceletInfo.consecrationMaster && (
                <div className="zen-flex zen-items-center zen-gap-lg">
                  <span style={{ fontSize: '1.5rem' }}>üë®‚Äçü¶≤</span>
                  <div>
                    <div style={{
                      fontSize: 'var(--zen-text-xs)',
                      color: 'var(--zen-text-tertiary)',
                      marginBottom: 'var(--zen-space-xs)'
                    }}>
                      ‰∏ªÊåÅÊ≥ïÂ∏à
                    </div>
                    <div style={{
                      fontSize: 'var(--zen-text-base)',
                      color: 'var(--zen-text-primary)',
                      fontWeight: 500
                    }}>
                      {braceletInfo.consecrationMaster}
                    </div>
                  </div>
                </div>
              )}
            </div>

            {braceletInfo.consecrationVideo && (
              <AnimatePresence>
                {showConsecrationVideo ? (
                  <motion.div
                    initial={{ opacity: 0, height: 0 }}
                    animate={{ opacity: 1, height: 'auto' }}
                    exit={{ opacity: 0, height: 0 }}
                    style={{
                      marginTop: 'var(--zen-space-lg)'
                    }}
                  >
                    <h4 style={{
                      fontSize: 'var(--zen-text-base)',
                      fontWeight: 600,
                      color: 'var(--zen-text-primary)',
                      marginBottom: 'var(--zen-space-md)',
                      textAlign: 'center'
                    }}>
                      üé• ÂºÄÂÖâ‰ª™ÂºèËßÜÈ¢ë
                    </h4>
                    
                    <div style={{
                      borderRadius: 'var(--zen-radius-lg)',
                      overflow: 'hidden',
                      background: '#000',
                      marginBottom: 'var(--zen-space-md)'
                    }}>
                      <video
                        controls
                        style={{
                          width: '100%',
                          height: '200px',
                          objectFit: 'cover'
                        }}
                        poster={braceletInfo.imageUrl || "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMWEyMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuW8gOWFieS7quW8jzwvdGV4dD48L3N2Zz4="}
                      >
                        <source src={braceletInfo.consecrationVideo} type="video/mp4" />
                        ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÊí≠Êîæ
                      </video>
                    </div>

                    <div style={{
                      background: 'var(--zen-success-alpha)',
                      border: '1px solid var(--zen-success)',
                      borderRadius: 'var(--zen-radius-md)',
                      padding: 'var(--zen-space-md)',
                      color: 'var(--zen-success-light)',
                      fontSize: 'var(--zen-text-sm)',
                      textAlign: 'center'
                    }}>
                      üôè Ê≠§ËßÜÈ¢ëËÆ∞ÂΩï‰∫ÜÊÇ®Êâã‰∏≤ÁöÑÂºÄÂÖâ‰ª™ÂºèÂÖ®ËøáÁ®ãÔºåËØ∑ÁèçËóè
                    </div>
                  </motion.div>
                ) : (
                  <motion.button
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    className="zen-btn zen-btn-ghost zen-btn-sm"
                    onClick={() => setShowConsecrationVideo(true)}
                    style={{
                      width: '100%',
                      marginTop: 'var(--zen-space-md)',
                      background: 'var(--zen-primary-alpha-10)',
                      border: '1px solid var(--zen-primary-alpha-30)',
                      color: 'var(--zen-primary)'
                    }}
                  >
                    üé• ËßÇÁúãÂºÄÂÖâ‰ª™ÂºèËßÜÈ¢ë
                  </motion.button>
                )}
              </AnimatePresence>
            )}
          </motion.div>
        )}

        {/* Â∫ïÈÉ®Êìç‰Ωú */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          className="zen-flex zen-gap-md"
        >
          <button
            className="zen-btn zen-btn-secondary"
            onClick={() => setShowVerificationModal(true)}
            style={{ flex: 1 }}
          >
            Êõ¥Êç¢Êâã‰∏≤
          </button>
          
          <button
            className="zen-btn zen-btn-primary"
            onClick={() => onNavigate('deity-chat')}
            style={{ flex: 1 }}
          >
            ‰∏éÁ•û‰ªôÂØπËØù
          </button>
        </motion.div>
      </div>

      {/* È™åËØÅÊ®°ÊÄÅÊ°Ü */}
      <AnimatePresence>
        {showVerificationModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'var(--zen-bg-overlay)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              padding: 'var(--zen-space-lg)',
              zIndex: 1000
            }}
            onClick={() => setShowVerificationModal(false)}
          >
            <motion.div
              initial={{ scale: 0.8, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.8, opacity: 0 }}
              className="zen-card"
              style={{ maxWidth: '400px', width: '100%' }}
              onClick={(e) => e.stopPropagation()}
            >
              <div className="zen-flex zen-justify-between zen-items-center zen-mb-lg">
                <h3 style={{
                  fontSize: 'var(--zen-text-lg)',
                  fontWeight: 600,
                  color: 'var(--zen-text-primary)'
                }}>
                  Êõ¥Êç¢Êâã‰∏≤
                </h3>
                
                <button
                  onClick={() => setShowVerificationModal(false)}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: 'var(--zen-text-tertiary)',
                    cursor: 'pointer',
                    fontSize: '1.2rem'
                  }}
                >
                  ‚úï
                </button>
              </div>
              
              <div className="zen-form-group">
                <label className="zen-label">Êñ∞ÁöÑÊâã‰∏≤ÁºñÂè∑</label>
                <input
                  type="text"
                  value={braceletIdInput}
                  onChange={(e) => setBraceletIdInput(e.target.value)}
                  placeholder="ËØ∑ËæìÂÖ•Êâã‰∏≤ÁºñÂè∑"
                  className="zen-input"
                />
              </div>
              
              <div className="zen-flex zen-gap-md">
                <button
                  className="zen-btn zen-btn-ghost"
                  onClick={() => setShowVerificationModal(false)}
                  style={{ flex: 1 }}
                >
                  ÂèñÊ∂à
                </button>
                
                <button
                  className="zen-btn zen-btn-primary"
                  onClick={handleVerifyBracelet}
                  disabled={isVerifying || !braceletIdInput.trim()}
                  style={{ flex: 1 }}
                >
                  {isVerifying ? 'È™åËØÅ‰∏≠...' : 'È™åËØÅ'}
                </button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

export default BraceletPageOptimized; 